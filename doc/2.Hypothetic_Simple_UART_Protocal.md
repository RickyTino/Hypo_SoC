# Hypothetic Simple UART Protocal

## 1. 概述

HSUP 传输协议

## 2. 标准

UART Lite 的参数如下：

- FIFO 容量：16bit
- 数据容量：8bit

于是 FIFO 中最多能够容纳2个字节即1个半字的数据；

于是规定一组数据为16个字节，或者16个ASCII字符。

## 3. 信号约定

### 传输模式

- CHAR 模式：每一个元数据为一个 CHAR (0xFF)

### 数据容量信号

在每组的第一个 CHAR 中，规定了之后的有效数据有多少个 CHAR。

于是：

- 对于16个 Char 的传输，有效数据信号占了1个 Char，所以每个 SOCKET 的有效数据为15个 Char

但是，对于一般数据，每个 SOKET 都占满了数据位，所以 0x0 偏移处的数据一定为 0xF

于是传输序列像这样：

```
0F 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E
```

对于最后传输的一个 SOKET， 它的数据量为：

- CHAR 模式最后一次数据量 = (FileSize_Bits / 8) % 15

例如：

```
03 F1 F2 F3 ...
```

### 每次传输前两次数据 ：传输类型以及名称

前两组数据中 0x1 偏移地址为传输类型：

- 0 - 文件
- 1 - 文本

如果传输的为文本的话，那么传输的是直接数据，否则传输的是文件名称

例如：

```
04 01 41 41 41 ....
传输了 AAA
```

```
04 00 41 41 41 ....
传输文件的文件名为 AAA
```

于是，定义前两组为此模式，可以知道传输的有效数据最多为 16-2)x2 = 28 个字符长度，即最高支持传输文件名长度为 28 的文件。

## 4. 数据传输

此节给出数据传输方 Transimitter 的传输动作序列。

首先发送方发出一组数据，并计算第[1]与 数据最后一位[DATA(0x0)]的和 SUM_TX

```
0F 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E
```

然后等待接收方返回 0xAC 与 SUM_RX

- 若 SUM 不符合则先发送 0xBC，然后接收 0xAC ，然后Retry，若 Retry 3次均失败则传输错误
- 若 SUM 相符合则发送 0xAC 然后接收 0xAC 再传输下一组 SOCKET

## 5. 数据接收

此节给出数据传输方 Receiver 的接收动作序列。

当 RX_FIFO 有效的时候一直接受数据，接收 16 次；

接收完毕后 计算第[1]与 数据最后一位[DATA(0x0)]的和 SUM_RX，然后发送 0xAC 与 SUM_RX，然后接收

- 若收到 0xBC 则丢弃此组数据， 发送 0xAC 表示通知
- 若收到 0xAC 则说明此组数据有效， 发送 0xAC 表示通知

## 6.状态机

假设 UART 已经初始化并且自检完成

### 6.1 发送方



### 6.2 接收方